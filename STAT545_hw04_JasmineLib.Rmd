---
title: "STAT545_hw04_JasmineLib"
output: github_document
---
## STAT 545 Homework 4

####In this assignment I chose the following two activities:   

**Data Reshaping Prompt - Activity #2:   **
- Make a tibble with one row per year and columns for life expectancy for two or more countries.  
- Use knitr::kable() to make this table look pretty in your rendered homework.  
- Take advantage of this new data shape to scatterplot life expectancy for one country against that of another.  

**Join Prompt - Activity #1  **
- Create a second data frame, complementary to Gapminder. 
- Join this with (part of) Gapminder using a dplyr join function and make some observations about the process and result.   
- Explore the different types of joins.   



First, Start by loading packages:   
```{r}
suppressPackageStartupMessages(library(tidyverse)) 
suppressPackageStartupMessages(library(gapminder))
```


###Data Reshaping Prompts (and relationship to aggregation) - Activity #2

Section 1: Make a tibble with one row per year and columns for life expectancy for two or more countries.
```{r}
filter_gapminder = gapminder %>% 
  select (year, lifeExp, country) %>% #select specific variables of interest
  filter (country == "China" | country == "India" | country == "Japan" ) %>% #select countries of interest
   spread(key = "country", value = "lifeExp")

filter_gapminder

```


Section 2: Use knitr::kable() to make this table look pretty in your rendered homework.  
```{r}
filter_gapminder  %>% 
  knitr::kable()
  

```

Section 3: Take advantage of this new data shape to scatterplot life expectancy for one country against that of another.  
- I am curious to compare the life expectancy of China and India over time.   
- I plot another line with a slope of 1, intercept (0,0) to help with visualization.   
- Points to the left of this line signify that India (y-axis) has a higher life expectancy for the year,  
- points on the right of the line signify that China (x-axis) had a higher life expectancy for that year.   

```{r}

filter_gapminder %>% 
  ggplot (aes(China, India)) + #plot life expectancy of China and India
  geom_point(aes(colour = year)) + #legend helps show the direction/flow of time
  theme_classic() + 
  ggtitle("Life Expectancy in China vs. India") +
  labs(x = "China Life Expectancy (Years)", y = "India Life Expectancy (Years)") +
  scale_y_continuous(breaks=seq(from = 25, to =75, by=5)) + #fix the axis tick marks
  scale_x_continuous(breaks=seq(25,75, by=5)) +
  geom_abline(mapping = NULL, data = NULL, slope = 1, #add line (see explanation above)
  na.rm = FALSE) +
  theme(aspect.ratio=1) #a square plot is ideal for comparison in this plot. 
```



###Join Prompts (join, merge, look up) Activity #1

Section 1: Create a second data frame, complementary to Gapminder.   

I obtained data from the gapminder website, where you can find plenty of interesting data! [Check it out!](https://www.gapminder.org/data/)
The file that I used is a CSV file named "people_living_with_HIV_number_all_ages.csv" You might need to add it to your environment in order to access it. 

The data after selection contains the total number of people living with HIV in 2007, for each country. 
```{r}
#Obtained data from: https://www.gapminder.org/data/
numHIV = read_csv(file = "people_living_with_hiv_number_all_ages.csv")

#I only want data from the year 2007. 
numHIV_sel = numHIV %>% 
  select(geo, `2007`) %>% 
  mutate(country = geo) #add a variable called country, to facilitate joining (same variable name)

head(numHIV_sel)


```

Section 2: Join this with (part of) Gapminder using a dplyr join function and make some observations about the process and result.

First, I need to filter gapminder to select data only from 2007. 
- I create a table with the first few rows here to ensure I filtered the variables I want. 
```{r}
gapminder_sel = gapminder %>% 
  filter (year == "2007") %>% 
  select(country = "country", pop, gdpPercap, continent) #select the population and gdpPercap data for the year 2007. 
  
gapminder_sel %>% 
  head() %>% 
  knitr::kable()

```

Create a new data frame gapminder HIV which joins the gapminder_sel and numHIV_sel: 
- I use head(gapminderHIV) to ensure that the join worked. 
- I notice that some data is missing, but that's okay, we can remove the NAs later on.
```{r}
gapminderHIV = left_join(gapminder_sel, numHIV_sel, by= "country") # join columns, join by comparing country and geo columns. 

gapminderHIV
head(gapminderHIV) %>% 
  knitr::kable()

```

Create a graph:
- I am interested in HIV rates in the Americas.
- I want to normalize HIV cases using by population using mutate() in order to better represent the data. 
```{r}

gapminderHIV_america = gapminderHIV %>% 
  filter(continent =="Americas") %>% 
  mutate(HIVper100000 = `2007`/pop*100000) #calculate HIV cases per 100 000 people

knitr::kable(gapminderHIV_america)

#make a plot
gapminderHIV_america %>% 
  ggplot(aes(country, HIVper100000)) + 
  geom_point(na.rm = TRUE) + #remove NAs
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) + #use this to write axis text sideways + 
  labs(x = "Country", y = "HIV frequency per 100 000 people") +  
  scale_y_continuous(breaks=seq(from = 0, to =1500, by=200)) 

```

Section 3: Explore the different types of joins. 
Right_join:
```{r}
gapminderHIV_right = right_join(gapminder_sel, numHIV_sel, by= "country")

head(gapminderHIV_right) %>% 
  knitr::kable()
```



anti_join: tells us what rows in gapminder don't have a match in the HIV dataset:
```{r, message = FALSE}

gapminderHIV_anti = anti_join(gapminder_sel, numHIV_sel, by= "country")
head(gapminderHIV_anti) %>% 
  knitr::kable()

nrow(gapminderHIV_anti) 
```
From these results, we can see that 21 countries were found in gapminder that did not have a match in the HIV dataset. 
Some of the countries are shown in the table above using the head() function. 


using anti_join once again, we can reverse the order of the dataframes in the command to see what rows in the HIV dataset don't have a match in gapminder:
```{r}
gapminderHIV_revanti = anti_join(numHIV_sel, gapminder_sel, by = "country" )

  head(gapminderHIV_revanti) %>% 
  knitr::kable()
  
  nrow(gapminderHIV_revanti)
```
We can see that 28 countries are found in the HIV dataset, but not in gapminder. Some of those countries are shown above using the head() function. 


